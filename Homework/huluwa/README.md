# 葫芦娃大作业
## 程序运行
1. 空格键开始游戏
2. 'L'键回放游戏记录
3. 回车键重新开始游戏

## 设计说明
### 地图大小：
800*600（像素大小）
### 阵型设置：

1. 葫芦娃：葫芦兄弟以**长蛇阵**准备战斗，保护后方的爷爷
2. 妖怪：小喽啰以**鹤翼阵**排列，蝎子精和蛇精在阵型中间

### 战斗设定
1. 双方在距离**<50**时会进行攻击，以优先线程的生物为依据进行概率计算死亡：如：如果是爷爷主动发起攻击，那么有0.4的概率是妖怪死亡，0.6的概率是爷爷死亡。（不同生物有不同的概率值计算）
2. 死亡的生物会以墓碑的形式显示在屏幕上，一旦某一方生物全部死亡，战斗结束

### 具体实现
#### 1. 程序类
* Main类：主程序main
* Field类：进行场景的绘制、图片加载和键盘响应以更新状态信息。
* Ground类：进行行动的控制，包括创建线程、初始化生物、创建计时器、判断是否能够移动、判断是否能够攻击、对状态进行检查并更新、文件写入和读取操作，相当于游戏的操纵者。
* Creature类：生物类，在生物类的具体实现中添加了HuluTeam类，表示葫芦兄弟方和MonsterTeam类，表示妖怪方。包括运行线程实现生物体的行为。
* Position类：位置信息类，存储生物的位置信息
* Read类：文件读取
* Write类：文件写入

#### 2. 生物行为
* 为每一个生物创建一个线程，在run()函数中进行生物的运动，攻击 + 移动
* 攻击：获取现在所有可以攻击的对象(相邻距离**<50**)，虽然是按概率计算死亡，但每个生物都有一个攻击值，在所有可以攻击的对象中寻找当前攻击值最高的对象并进行攻击。概率计算死亡。
* 移动：若没有可以攻击的对象，则寻找相邻最近的敌方并比较dx和dy值的大小，选择较小的方向进行移动。

#### 3. 回放
* 系统中有一个计时器timer，当有行动发生时，负责检查当前生物存活状态和进行文件写入与读取。
* 写入：把当前葫芦兄弟方、妖怪方和已死亡的生物的名字、位置及存货状态写入文件。文件名默认为当前的时间（用Date类获取当前时间），可以在战斗结束后按下'R'键进行文件名修改。
* 读取：当程序进入回放状态后，重新初始化计时器、生物体和线程，根据读到的字符串划分出所写入的生物名、位置信息及存活状态并赋予生物体。

#### 4. 单元测试
* 对葫芦娃和蛇精类的存活状态设定、名字获取和图片载入进行测试，均通过
* 对读入文件Read类的设定读取文件函数进行测试，通过
* 对位置信息Position类位置信息获取和设定操作进行测试，通过

### 感想
Java的作业让我意识到了拖延症的严重后果，在DDL临近的时候才开始写，实现的较为简单，也有很多不足，如：没有联合第三次实验的队形类进行队形的设定，而是直接设定位置，这样程序的趣味性少了很多。并且只是爱惨了线程的简单并发运行，Java很多机制都没有实现，代码风格也有点混乱，希望以后能够再修改完善。
